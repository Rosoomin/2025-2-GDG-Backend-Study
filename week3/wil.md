## 복습)

### 스프링 계층형 아키텍쳐
* 컨트롤러 게층 : 클라이언트로부터 들러온 요청을 받아서 어떤 서비스를 실행할지 결정을 하고 결과를 응답으로 돌려주는 계층
* 서비스 계층 : 애플리케이션의 비즈니스 로직이 담기는 계층, 컨트롤러와 레포지토리 사이의 중간다리
* 레포지토리 계층 : 데이터베이스에 접근을 해서 CRUD 작업을 하는 계층

### CRUE란?
- C : Create : 데이터 생성
- R : Read : 데이터 조회
- U : Update : 기존 데이터 수정
- D : Delete : 데이터삭제

### 레포지토리가 데이터베이스에 접근하는 방법:
- 애플리케이션 서버는 DB가 이해할 수 있는 SQL을 열결된 커넥션을 통해 DB에 전달
- DB는 전달된 SQL을 수행하고 그 결과를 응답, 애플리케이션 서버는 결과 활용

### JDBC : Java 에서 데이터베이스에 접근하기 위한 표준화된 API
JDBC API를 이용하면 특정 데이터베이스에 종속되지 않고 같은 방식으로 코드를 작성할수있고 , 내부적으로는 JDBC가 각 데이터베이스에 맞는 드라이버를 통해서 실제 SQL을 전달해줌

하지만 JDBC처럼 SQL을 직접 다루는 방식은 몇가지 근본적인 한계 존재
- 개발자는 CRUD 작업을 위해서 매번 유사한 SQL코드를 반복적으로 작성해야함
- 또한 객체의 필드 하나만 변경되어도 관련된 SQL문을 일일히 찾아서 수정해야함
- 객체와 데이터베이스 간 패러다임 불일치문제

=> 이런 문제해결하기 위한 기술 : ORM

### ORM : Object-Relational Mapping
- 객체와 관계형 데이터베이스의 데이터를 자동으로 매핑해주는 것
- 반복적인 CRUD SQL 자동으로 처리됨

### JPA : Java Persistence API
- 자바 진영의 ORM 기술 표준
- 자바에서 객체를 데이터베이스에 저장하고 관리하기 위한 인터페이스와 기능을 제공하는 API

### JPA의 기능 대부분은 Entitiy Manager이 제공
Entitiy Manager : 객체를 데이터베이스와 연결해주는 창구 역할
- 엔티티 매니저를 사용해서 SQL을 직접 작성하지 않고도 엔티티를 데이터베이스에 등록/수정/조회/삭제 가능
ex) 등록 : `em.persist()`, 조회 : `em.find()`, 삭제 : `em.remove()`
- 엔티티 매저는 엔티티를 영속성 컨텍스트에 저장해서 관리함

### 영속성 컨텍스트
- JPA에서 엔티티를 관리하기 위해 만들어져있는 가상 공간
- 애플리케이션과 데이터베이스 사이에서 객체를 보관하는 가상의 데이터베이스 같은 역할이고 엔티티 매니저를 통해 접근 가능

### 엔티티는 영속성 컨텍스트에 의해 생명주기라는 것이 관리됨
네 가지 상태가 존재
- 비영속 : 영속성 컨텍스트와 관련 없는 상태
- 영속 : 영속성 컨텍스트에 저장된 상태. 엔티티가 영속성 컨텍스트에 의해 관리됨
- 준영속 : 영속성 컨텍스트에 저장되었다가 분리된 상태
- 삭제 : 영속성 컨텍스트에 엔티티가 삭제될거라고 기록한 상태

### 영속성 컨텍스트의 특징
- 1차 캐시
- 동일성 보장
- 트랜잭션을 지원하는 쓰기 지연
- 변경 감지

### 트랜잭션
- 데이터베이스에서 수행되는 작업의 단위
- 여러개의 데이터베이스 연산을 하나의 논리적인 작업 단위로 묶어서 실행
    - 모든 연산이 수행 되면 트랜잭션을 커밋하여 데이터베이스에 반영
    - 하나라도 실패하면 롤백하여 이전 상태로 되돌림
- 더 이상 쪼갤 수 없는 원자성을 가짐

### 트랜잭션을 지원하는 쓰기 지원
- 데이터베이스에 바로 쓰는 것이 아니라 변경사항들을 모아두었다가 트랜잭션이 완료되는 시점에 한 번에 묶어서 DB에 보내는 구조.
- 쿼리를 데이터베이스에 한 번에 전달할 수 있으므로 데이터베이스와의 네트워킹 횟수를 줄여 성능을 최적화 할 수 있다.

### 1차 캐시
- 한번 조회한 객체를 영속성 컨텍스트가 내부에 저장해두고 재사용하는 구조
- 영속성 컨텍스트에 이미 등록된 객체를 조회할 때는 데이터베이스를 거치지지 않아도 됨

### 동일성 보장
- 트랜잭션 안에서는 같은 엔티티를 여러번 조회해도 영속성 컨텍스트에 보관된 같은 객체를 그대로 반환하므로 항상 동일한 객체임이 보장된다

### 변경 감지 (Dirty Checking)
- 영속성 컨텍스트가 엔티티의 변경 사항을 자동으로 감지하고, 트랜잭션 커밋 시점에 변경 내용을 DB에 반영하는 것
- 변경 감지는 영속성 컨텍스트가 관리하는 영속 상태의 엔티티에만 적용